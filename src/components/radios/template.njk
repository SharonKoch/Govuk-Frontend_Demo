{% from "../form-group/macro.njk" import govukFormGroup %}
{% from "../hint/macro.njk" import govukHint %}
{% from "../label/macro.njk" import govukLabel %}

{#- If an id 'prefix' is not passed, fall back to using the name attribute
   instead. We need this for error messages and hints as well -#}
{% set idPrefix = params.idPrefix if params.idPrefix else params.name %}

{% set isConditional = false %}
{% for item in params.items %}
  {% if item.conditional %}
    {% set isConditional = true %}
  {% endif %}
{% endfor %}

{% call govukFormGroup({
  id: idPrefix,
  fieldset: params.fieldset,
  hint: params.hint,
  label: params.label,
  errorMessage: params.errorMessage,
  formGroup: params.formGroup
}) %}
  <div class="govuk-radios {%- if params.classes %} {{ params.classes }}{% endif %}{%- if isConditional %} govuk-radios--conditional{% endif -%}"
    {%- for attribute, value in params.attributes %} {{ attribute }}="{{ value }}"{% endfor %}
    {%- if isConditional %} data-module="govuk-radios"{% endif -%}>
    {% for item in params.items %}
    {#- If the user explicitly sets an id, use this instead of the regular idPrefix -#}
    {%- if item.id -%}
      {%- set id = item.id -%}
    {%- else -%}
      {#- The first id should not have a number suffix so it's easy to link to from the error summary component -#}
      {%- if loop.first -%}
        {%- set id = idPrefix %}
      {% else %}
        {%- set id = idPrefix + "-" + loop.index -%}
      {%- endif -%}
    {%- endif -%}
    {% set conditionalId = "conditional-" + id %}
    {%- if item.divider %}
    <div class="govuk-radios__divider">{{ item.divider }}</div>
    {%- else %}
    {% set hasHint = true if item.hint.text or item.hint.html %}
    {% set itemHintId = id + '-item-hint' %}
    <div class="govuk-radios__item">
      <input class="govuk-radios__input" id="{{ id }}" name="{{ params.name }}" type="radio" value="{{ item.value }}"
      {{-" checked" if item.checked }}
      {{-" disabled" if item.disabled }}
      {%- if item.conditional %} data-aria-controls="{{ conditionalId }}"{% endif -%}
      {%- if hasHint %} aria-describedby="{{ itemHintId }}"{% endif -%}
      {%- for attribute, value in item.attributes %} {{ attribute }}="{{ value }}"{% endfor -%}>
      {{ govukLabel({
        html: item.html,
        text: item.text,
        classes: 'govuk-radios__label' + (' ' + item.label.classes if item.label.classes),
        attributes: item.label.attributes,
        for: id
      }) | indent(6) | trim }}
      {% if hasHint %}
      {{ govukHint({
        id: itemHintId,
        classes: 'govuk-radios__hint',
        attributes: item.hint.attributes,
        html: item.hint.html,
        text: item.hint.text
      }) | indent(6) | trim }}
      {% endif %}
    </div>
    {% if item.conditional %}
      <div class="govuk-radios__conditional{% if not item.checked %} govuk-radios__conditional--hidden{% endif %}" id="{{ conditionalId }}">
        {{ item.conditional.html | safe }}
      </div>
    {% endif %}
    {% endif %}
    {% endfor %}
  </div>
{% endcall %}
